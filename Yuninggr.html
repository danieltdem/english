<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯§å¯§çš„ Present Perfect å¯¦æˆ°æ¨¡æ“¬è€ƒ</title>
    <style>
        body {
            font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
            background-color: #f4f6f9;
            color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .exam-card {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 700px;
            padding: 40px;
            text-align: center;
        }

        h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 5px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            background-color: #ecf0f1;
            height: 10px;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #3498db;
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-box {
            background-color: #eaf2f8;
            border: 2px solid #d4e6f1;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            font-size: 20px;
            font-weight: bold;
            color: #2980b9;
            line-height: 1.6;
        }

        .hint-text {
            font-size: 14px;
            color: #e74c3c;
            margin-top: 10px;
            font-weight: normal;
        }

        input[type="text"] {
            width: 90%;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #bdc3c7;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s;
            margin-bottom: 20px;
        }

        input[type="text"]:focus {
            border-color: #3498db;
        }

        .feedback {
            min-height: 50px;
            margin-bottom: 20px;
            font-size: 16px;
            text-align: left;
            padding: 15px;
            border-radius: 10px;
            display: none; /* Initially hidden */
        }

        .feedback.error {
            background-color: #fdedec;
            color: #c0392b;
            border-left: 5px solid #e74c3c;
        }

        .feedback.success {
            background-color: #e8f8f5;
            color: #27ae60;
            border-left: 5px solid #2ecc71;
        }

        .controls button {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.2s;
        }

        .btn-submit {
            background-color: #2ecc71;
            color: white;
            box-shadow: 0 4px 0 #27ae60;
        }
        .btn-submit:active { transform: translateY(4px); box-shadow: none; }

        .btn-next {
            background-color: #f39c12;
            color: white;
            display: none;
        }

        .btn-hint {
            background-color: #95a5a6;
            color: white;
            font-size: 14px;
            padding: 8px 15px;
        }

        /* é—œéµå­—é«˜äº® */
        .keyword {
            background-color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px dashed #aaa;
            margin: 0 4px;
            display: inline-block;
        }

    </style>
</head>
<body>

    <div class="exam-card">
        <h1>Present Perfect Simulation</h1>
        <div class="subtitle">Teacher Ningning's Strict Grammar Class ğŸ˜¤</div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="question-box" id="questionText">
            Loading...
        </div>

        <input type="text" id="userInput" placeholder="Type the complete sentence here..." autocomplete="off">

        <div class="feedback" id="feedbackMsg"></div>

        <div class="controls">
            <button class="btn-hint" onclick="showHint()">ğŸ’¡ å·çœ‹å‹•è©è®ŠåŒ– (Hint)</button>
            <button class="btn-submit" id="submitBtn" onclick="checkAnswer()">é€å‡ºç­”æ¡ˆ (Submit)</button>
            <button class="btn-next" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ (Next)</button>
        </div>
    </div>

    <script>
        // é¡Œç›®è³‡æ–™åº«
        // prompt: é¡¯ç¤ºçµ¦ä½ çœ‹çš„æç¤ºå­— (åŸå½¢å‹•è©)
        // verbBase: åŸå½¢å‹•è© (ç”¨æ–¼åµæ¸¬éŒ¯èª¤)
        // verbV3: æ­£ç¢ºçš„éå»åˆ†è© (ç”¨æ–¼æç¤º)
        // answers: æ­£ç¢ºç­”æ¡ˆé™£åˆ— (è€ƒæ…®å¯èƒ½çš„ç¸®å¯«æˆ–è®Šé«”ï¼Œä½†é€™è£¡å»ºè­°æ¨™æº–å¯«æ³•)
        const questions = [
            {
                prompt: ["I", "drink", "already", "a", "bottle", "of", "cola"],
                verbBase: "drink",
                verbV3: "drunk",
                answers: ["I have already drunk a bottle of cola.", "I've already drunk a bottle of cola."],
                note: "è¨˜å¾—ï¼šalready é€šå¸¸æ”¾åœ¨ have å’Œ p.p. ä¹‹é–“ã€‚"
            },
            {
                prompt: ["She", "not / finish", "her", "homework", "yet"],
                verbBase: "finish",
                verbV3: "finished",
                answers: ["She has not finished her homework yet.", "She hasn't finished her homework yet."],
                note: "å¦å®šå¥è¦ç”¨ has not (hasn't)ã€‚Yet æ”¾åœ¨å¥å°¾ã€‚"
            },
            {
                prompt: ["(Question)", "You", "ever / be", "to", "Japan"],
                verbBase: "be",
                verbV3: "been",
                answers: ["Have you ever been to Japan?", "Have you ever been to Japan"],
                note: "å•å¥é–‹é ­è¦ç”¨ Have/Hasã€‚Ever æ”¾åœ¨ä¸»è©å¾Œé¢ã€‚"
            },
            {
                prompt: ["We", "live", "in", "Hsinchu", "for", "ten", "years"],
                verbBase: "live",
                verbV3: "lived",
                answers: ["We have lived in Hsinchu for ten years.", "We've lived in Hsinchu for ten years."],
                note: "ä½äº†ä¸€æ®µæ™‚é–“ï¼ŒæŒçºŒåˆ°ç¾åœ¨ï¼Œç”¨å®Œæˆå¼ã€‚"
            },
            {
                prompt: ["I", "buy", "VOO (stock)", "just"],
                verbBase: "buy",
                verbV3: "bought",
                answers: ["I have just bought VOO.", "I've just bought VOO."],
                note: "Just (å‰›å‰›) æ”¾åœ¨ have å’Œ p.p. ä¹‹é–“ã€‚"
            },
            {
                prompt: ["The", "train", "leave", "already", "the", "station"],
                verbBase: "leave",
                verbV3: "left",
                answers: ["The train has already left the station."],
                note: "ç«è»Š (The train) æ˜¯å–®æ•¸ï¼Œè¨˜å¾—ç”¨ hasã€‚"
            }
        ];

        let currentIdx = 0;
        const questionText = document.getElementById('questionText');
        const userInput = document.getElementById('userInput');
        const feedbackMsg = document.getElementById('feedbackMsg');
        const submitBtn = document.getElementById('submitBtn');
        const nextBtn = document.getElementById('nextBtn');
        const progressBar = document.getElementById('progressBar');

        function loadQuestion() {
            // é‡ç½®ç‹€æ…‹
            userInput.value = "";
            userInput.focus();
            feedbackMsg.style.display = "none";
            feedbackMsg.className = "feedback";
            submitBtn.style.display = "inline-block";
            nextBtn.style.display = "none";

            // æ›´æ–°é€²åº¦æ¢
            const percentage = ((currentIdx) / questions.length) * 100;
            progressBar.style.width = percentage + "%";

            // çµ„åˆé¡Œç›®é¡¯ç¤º (å°‡é™£åˆ—è®Šæˆçœ‹èµ·ä¾†åƒè€ƒå·çš„æ–œç·šåˆ†éš”)
            const q = questions[currentIdx];
            // æŠŠæ¯å€‹å–®å­—åŒ…åœ¨ keyword æ¨£å¼è£¡
            const htmlPrompt = q.prompt.map(word => `<span class="keyword">${word}</span>`).join(" / ");
            
            questionText.innerHTML = `
                <div>è«‹é‡çµ„ä¸¦æ”¹å¯«å¥å­ (Present Perfect)ï¼š</div>
                <div style="margin-top:15px; font-size: 1.2em;">${htmlPrompt}</div>
                <div class="hint-text">âš ï¸ å¿…é ˆè‡ªè¡ŒåŠ å…¥ have/has ä¸¦å°‡å‹•è©æ”¹ç‚º p.p.</div>
            `;
        }

        function checkAnswer() {
            const userAns = userInput.value.trim();
            const q = questions[currentIdx];
            
            // ç°¡å–®çš„æ¨™æº–åŒ–ï¼šç§»é™¤å¤šé¤˜ç©ºç™½ï¼Œçµ±ä¸€æ¨™é» (é›–ç„¶ç­”æ¡ˆåº«æœ‰æ¨™é»ï¼Œä½†ç‚ºäº†å®¹éŒ¯ï¼Œæˆ‘å€‘å¯ä»¥å¯¬å®¹ä¸€é»)
            // é€™è£¡æ¡ç”¨åš´æ ¼æ¯”å°ç­”æ¡ˆåº« (User å¿…é ˆæ‰“å°æ¨™é»)
            // å¦‚æœä½ å¸Œæœ›ä¸æª¢æŸ¥æ¨™é»ï¼Œå¯ä»¥æŠŠä¸‹é¢çš„æª¢æŸ¥é‚è¼¯æ”¾å¯¬
            
            let isCorrect = false;
            // æª¢æŸ¥æ˜¯å¦ç¬¦åˆä»»ä¸€æ¨™æº–ç­”æ¡ˆ (å¿½ç•¥å¤§å°å¯«å·®ç•°ï¼Œä½†æœ€å¥½é‚„æ˜¯é¼“å‹µæ­£ç¢ºå¤§å°å¯«)
            if (q.answers.some(ans => ans.toLowerCase() === userAns.toLowerCase() || 
                                      ans.replace('.','').toLowerCase() === userAns.replace('.','').toLowerCase())) {
                isCorrect = true;
            }

            if (isCorrect) {
                // ç­”å°
                feedbackMsg.innerHTML = `
                    <strong>âœ… Correct! å®Œå…¨æ­£ç¢ºï¼</strong><br>
                    ${q.answers[0]}<br>
                    <span style="font-size:0.9em; color:#666;">è§£æï¼š${q.note}</span>
                `;
                feedbackMsg.className = "feedback success";
                feedbackMsg.style.display = "block";
                submitBtn.style.display = "none";
                
                if (currentIdx < questions.length - 1) {
                    nextBtn.style.display = "inline-block";
                } else {
                    nextBtn.textContent = "å®Œæˆè€ƒè©¦ (Finish)";
                    nextBtn.style.display = "inline-block";
                    nextBtn.onclick = () => {
                        progressBar.style.width = "100%";
                        alert("å¤ªæ£’äº†å¯§å¯§ï¼ä½ é€šéäº†æ‰€æœ‰æ¸¬é©—ï¼");
                    };
                }
            } else {
                // ç­”éŒ¯ - é€²è¡Œæ™ºæ…§è¨ºæ–·
                let errorMsg = "<strong>âŒ Try again!</strong><br>";
                const lowerUser = userAns.toLowerCase();
                
                // è¨ºæ–· 1: å¿˜è¨˜åŠ  have/has
                if (!lowerUser.includes("have") && !lowerUser.includes("has") && !lowerUser.includes("'ve") && !lowerUser.includes("'s")) {
                    errorMsg += "ğŸ‘‰ ä½ å¥½åƒå¿˜è¨˜åŠ åŠ©å‹•è© <b>have</b> æˆ– <b>has</b> äº†ï¼<br>";
                }
                
                // è¨ºæ–· 2: å‹•è©æ²’è®ŠåŒ– (ç”¨äº†åŸå½¢)
                else if (lowerUser.includes(q.verbBase.toLowerCase()) && q.verbBase !== q.verbV3) {
                    errorMsg += `ğŸ‘‰ å‹•è© <b>${q.verbBase}</b> é‚„æ˜¯åŸå½¢å–”ï¼è¨˜å¾—æ”¹æˆéå»åˆ†è© (p.p.)ã€‚<br>`;
                }
                
                // è¨ºæ–· 3: ç”¨äº†éå»å¼è€Œä¸æ˜¯éå»åˆ†è© (ä¾‹å¦‚ç”¨ drank æ²’ç”¨ drunk)
                // é€™éœ€è¦å€‹åˆ¥è¨­å®šï¼Œé€™è£¡ç°¡å–®åˆ¤æ–·ï¼šå¦‚æœæœ‰å« have/has ä½†æ²’å«æ­£ç¢º p.p.
                else if (!lowerUser.includes(q.verbV3.toLowerCase())) {
                    errorMsg += `ğŸ‘‰ éå»åˆ†è©æ‹¼å¯«å¯èƒ½æœ‰èª¤ï¼Œæˆ–è€…å¥å­çµæ§‹ä¸å°ã€‚<br>`;
                } else {
                    errorMsg += "ğŸ‘‰ å¥å­é †åºæˆ–æ‹¼å­—æœ‰èª¤ï¼Œè«‹å†æª¢æŸ¥ä¸€æ¬¡ã€‚<br>";
                }

                feedbackMsg.innerHTML = errorMsg;
                feedbackMsg.className = "feedback error";
                feedbackMsg.style.display = "block";
            }
        }

        function showHint() {
            const q = questions[currentIdx];
            alert(`å‹•è© "${q.verbBase}" çš„éå»åˆ†è© (V3) æ˜¯ï¼š${q.verbV3}\n\nSubject + have/has + ${q.verbV3}...`);
        }

        function nextQuestion() {
            currentIdx++;
            loadQuestion();
        }

        // ç›£è½ Enter éµ
        userInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                if(submitBtn.style.display !== "none") {
                    checkAnswer();
                } else if (nextBtn.style.display !== "none") {
                    nextQuestion();
                }
            }
        });

        // å•Ÿå‹•
        loadQuestion();

    </script>
</body>
</html>
