<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><ruby>Êñá<rt>„Ñ®„Ñ£Àä</rt>Ê≥ï<rt>„Ñà„ÑöÀá</rt></ruby><ruby>ÈÅä<rt>„Ñß„Ñ°Àä</rt></ruby><ruby>Êà≤<rt>„Ñí„ÑßÀã</rt></ruby>ÔºöWho...? What...?</title>
    <style>
        /* CSS styles remain the same, no changes needed here */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            box-sizing: border-box;
        }
        ruby { /* Added style for better ruby/zhuyin readability */
            ruby-position: over;
        }
        rt { /* Added style for zhuyin font size */
            font-size: 0.7em;
            opacity: 0.9;
        }
        .container {
            text-align: center;
            background: white;
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 600px;
            transition: all 0.3s ease;
        }
        h1 {
            color: #333;
            margin-top: 10px;
            margin-bottom: 10px;
            font-size: 28px;
        }
        p {
            color: #666;
            margin-bottom: 20px;
            font-size: 16px;
        }
        #game-image {
            transition: all 0.5s ease;
        }
        #game-image.correct {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.4);
        }
        #game-image.incorrect {
            animation: shake 0.5s;
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }
        #game-image.all-correct {
            animation: celebration 1s ease-in-out;
            box-shadow: 0 8px 25px rgba(253, 203, 110, 0.4);
        }
        #game-status {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.5s ease;
        }
        #game-status.correct {
            background: linear-gradient(135deg, #00b894, #00a085);
            transform: scale(1.1);
        }
        #game-status.incorrect {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            animation: shake 0.5s;
        }
        #game-status.all-correct {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            animation: celebration 1s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes celebration {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(5deg); }
        }
        #progress {
            font-size: 16px;
            color: #555;
            margin-bottom: 15px;
            font-weight: bold;
            padding: 8px 16px;
            background: #f8f9fa;
            border-radius: 20px;
            display: inline-block;
        }
        #question {
            font-size: 22px;
            margin: 20px 0;
            color: #2c3e50;
            line-height: 2; /* Increased line-height for zhuyin */
            background: #f1f3f4;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #74b9ff;
        }
        #options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        .option-btn {
            padding: 15px 20px;
            font-size: 18px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-align: center;
            transform: translateY(0);
        }
        .option-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #0984e3, #74b9ff);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .option-btn.correct {
            background: linear-gradient(135deg, #00b894, #00a085) !important;
            transform: scale(1.05);
        }
        .option-btn.incorrect {
            background: linear-gradient(135deg, #fd79a8, #e84393) !important;
            animation: shake 0.5s;
        }
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        #result {
            font-size: 24px;
            margin-top: 20px;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
            line-height: 2; /* Increased line-height for zhuyin */
        }
        #explanation-container {
            font-size: 16px;
            margin-top: 15px;
            padding: 20px;
            background: linear-gradient(135deg, #fffbe6, #fff3cd);
            border-left: 5px solid #f39c12;
            border-radius: 10px;
            text-align: left;
            line-height: 2.2; /* Increased line-height for zhuyin */
            color: #5f4c0a;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        #score {
            font-size: 24px;
            margin-top: 10px;
            color: #333;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-weight: bold;
            line-height: 2; /* Increased line-height for zhuyin */
        }
        #wrong-questions {
            font-size: 16px;
            margin-top: 20px;
            text-align: left;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #e74c3c;
            max-height: 250px;
            overflow-y: auto;
            line-height: 2.5; /* Increased line-height for zhuyin */
        }
        #next-btn, #restart-btn, #retest-wrong-btn {
            padding: 15px 30px;
            font-size: 18px;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        #next-btn { 
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }
        #next-btn:hover { 
            background: linear-gradient(135deg, #e17055, #fdcb6e);
            transform: translateY(-2px);
        }
        #restart-btn { 
            background: linear-gradient(135deg, #00cec9, #00b894);
        }
        #restart-btn:hover { 
            background: linear-gradient(135deg, #00b894, #00cec9);
            transform: translateY(-2px);
        }
        #retest-wrong-btn { 
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
        }
        #retest-wrong-btn:hover { 
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <img id="game-image" src="initial.png" alt="Game Scene" style="width: 150px; height: 150px; object-fit: contain; margin-bottom: 20px; border-radius: 50%; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.5s ease;">
        <div id="game-status" style="display: none;">üéØ</div>
        
        <h1><ruby>Êñá<rt>„Ñ®„Ñ£Àä</rt>Ê≥ï<rt>„Ñà„ÑöÀá</rt></ruby><ruby>ÈÅä<rt>„Ñß„Ñ°Àä</rt></ruby><ruby>Êà≤<rt>„Ñí„ÑßÀã</rt></ruby>ÔºöWho...? What...?</h1>
        <p><ruby>Áúã<rt>„Ñé„Ñ¢Àã</rt></ruby><ruby>Áúã<rt>„Ñé„Ñ¢Àã</rt></ruby><ruby>Âúñ<rt>„Ñä„Ñ®Àä</rt></ruby><ruby>Áâá<rt>„ÑÜ„Ñß„Ñ¢Àã</rt></ruby><ruby>Êàñ<rt>„Ñè„Ñ®„ÑõÀã</rt></ruby><ruby>Âè•<rt>„Ñê„Ñ©Àã</rt></ruby><ruby>Â≠ê<rt>„ÑóÀô</rt></ruby>Ôºå<ruby>ÈÅ∏<rt>„Ñí„Ñ©„Ñ¢Àá</rt></ruby><ruby>Âá∫<rt>„Ñî„Ñ®</rt></ruby><ruby>ÊúÄ<rt>„Ñó„Ñ®„ÑüÀã</rt></ruby><ruby>Ê≠£<rt>„Ñì„Ñ•Àã</rt></ruby><ruby>Á¢∫<rt>„Ñë„Ñ©„ÑùÀã</rt></ruby><ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>Á≠î<rt>„Ñâ„ÑöÀä</rt></ruby><ruby>Ê°à<rt>„Ñ¢Àã</rt></ruby><ruby>Âêß<rt>Àô„ÑÖ„Ñö</rt></ruby>ÔºÅ</p>
        
        <div id="quiz-area">
            <div id="progress"></div>
            <div id="question"></div>
            <div id="options-container"></div>
            <div id="result"></div>
            <div id="explanation-container" style="display: none;"></div>
            <button id="next-btn" style="display: none;"><ruby>‰∏ã<rt>„Ñí„Ñß„ÑöÀã</rt></ruby><ruby>‰∏Ä<rt>„ÑßÀä</rt></ruby><ruby>È°å<rt>„Ñä„ÑßÀä</rt></ruby> ‚û°Ô∏è</button>
        </div>

        <div id="end-screen" style="display: none;">
            <h2>üéä <ruby>Ê∏¨<rt>„Ñò„ÑúÀã</rt></ruby><ruby>È©ó<rt>„Ñß„Ñ¢Àã</rt></ruby><ruby>Áµê<rt>„Ñê„Ñß„ÑùÀä</rt></ruby><ruby>Êùü<rt>„Ñï„Ñ®Àã</rt></ruby>ÔºÅ üéä</h2>
            <div id="score"></div>
            <div id="wrong-questions"></div>
            <button id="restart-btn">üîÑ <ruby>ÂÖ®<rt>„Ñë„Ñ©„Ñ¢Àä</rt></ruby><ruby>ÈÉ®<rt>„ÑÖ„Ñ®Àã</rt></ruby><ruby>Èáç<rt>„Ñî„Ñ®„Ñ•Àä</rt></ruby><ruby>Ê∏¨<rt>„Ñò„ÑúÀã</rt></ruby></button>
            <button id="retest-wrong-btn" style="display: none;">‚ùå <ruby>Èáç<rt>„Ñî„Ñ®„Ñ•Àä</rt></ruby><ruby>Ê∏¨<rt>„Ñò„ÑúÀã</rt></ruby><ruby>ÈåØ<rt>„Ñò„Ñ®„ÑõÀã</rt></ruby><ruby>È°å<rt>„Ñä„ÑßÀä</rt></ruby></button>
        </div>
    </div>

    <script>
        const allQuestions = [
            { question: "(<ruby>Áúã<rt>„Ñé„Ñ¢Àã</rt></ruby><ruby>Âà∞<rt>„Ñâ„Ñ†Àã</rt></ruby><ruby>‰∏Ä<rt>„ÑßÀä</rt></ruby><ruby>‰Ωç<rt>„Ñ®„ÑüÀã</rt></ruby><ruby>Áî∑<rt>„Ñã„Ñ¢Àä</rt></ruby><ruby>Â≠©<rt>„Ñè„ÑûÀä</rt></ruby>) ___ is that boy?", options: ["Who", "What"], answer: 0, explanation: "<ruby>Ë©¢<rt>„Ñí„Ñ©„Ñ£Àä</rt></ruby><ruby>Âïè<rt>„Ñ®„Ñ£Àã</rt></ruby><ruby>Èóú<rt>„Ñç„Ñ®„Ñ¢</rt></ruby><ruby>Êñº<rt>„Ñ©Àä</rt></ruby>„Äå<ruby>‰∫∫<rt>„Ññ„Ñ£Àä</rt></ruby>„Äç<ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>Âïè<rt>„Ñ®„Ñ£Àã</rt></ruby><ruby>È°å<rt>„Ñä„ÑßÀä</rt></ruby>Ôºå<ruby>Êàë<rt>„Ñ®„ÑõÀá</rt></ruby><ruby>ÂÄë<rt>Àô„Ñá„Ñ£</rt></ruby><ruby>Ë¶Å<rt>„Ñß„Ñ†Àã</rt></ruby><ruby>Áî®<rt>„Ñ©„Ñ•Àã</rt></ruby> Who (<ruby>Ë™∞<rt>„Ñï„ÑüÀä</rt></ruby>) <ruby>Âñî<rt>Àô„Ñõ</rt></ruby>ÔºÅ" },
            { question: "(<ruby>Áúã<rt>„Ñé„Ñ¢Àã</rt></ruby><ruby>Âà∞<rt>„Ñâ„Ñ†Àã</rt></ruby><ruby>‰∏Ä<rt>„ÑßÀã</rt></ruby><ruby>Èöª<rt>„Ñì</rt></ruby><ruby>Ë≤ì<rt>„Ñá„Ñ†</rt></ruby>) ___ is that?", options: ["Who", "What"], answer: 1, explanation: "<ruby>Ë©¢<rt>„Ñí„Ñ©„Ñ£Àä</rt></ruby><ruby>Âïè<rt>„Ñ®„Ñ£Àã</rt></ruby><ruby>Èóú<rt>„Ñç„Ñ®„Ñ¢</rt></ruby><ruby>Êñº<rt>„Ñ©Àä</rt></ruby>„Äå<ruby>Âãï<rt>„Ñâ„Ñ®„Ñ•Àã</rt></ruby><ruby>Áâ©<rt>„Ñ®Àã</rt></ruby>„Äç<ruby>Êàñ<rt>„Ñè„Ñ®„ÑõÀã</rt></ruby>„Äå<ruby>Êù±<rt>„Ñâ„Ñ®„Ñ•</rt></ruby><ruby>Ë•ø<rt>Àô„Ñí„Ñß</rt></ruby>„Äç<ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>Âïè<rt>„Ñ®„Ñ£Àã</rt></ruby><ruby>È°å<rt>„Ñä„ÑßÀä</rt></ruby>Ôºå<ruby>Ë¶Å<rt>„Ñß„Ñ†Àã</rt></ruby><ruby>Áî®<rt>„Ñ©„Ñ•Àã</rt></ruby> What (<ruby>‰ªÄ<rt>„Ñï„Ñ£Àä</rt></ruby><ruby>È∫º<rt>Àô„Ñá„Ñú</rt></ruby>)„ÄÇ" },
            { question: "(<ruby>Êåá<rt>„ÑìÀá</rt></ruby><ruby>Ëëó<rt>Àô„Ñì„Ñú</rt></ruby><ruby>Êâã<rt>„Ñï„Ñ°Àá</rt></ruby><ruby>‰∏ä<rt>„Ñï„Ñ§Àã</rt></ruby><ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>Êº¢<rt>„Ñè„Ñ¢Àã</rt></ruby><ruby>Â†°<rt>„ÑÖ„Ñ†Àá</rt></ruby>) What's ___?", options: ["this", "that"], answer: 0, explanation: "<ruby>Êåá<rt>„ÑìÀá</rt></ruby><ruby>Èù†<rt>„Ñé„Ñ†Àã</rt></ruby><ruby>Ëøë<rt>„Ñê„Ñß„Ñ£Àã</rt></ruby><ruby>Ëá™<rt>„ÑóÀã</rt></ruby><ruby>Â∑±<rt>„Ñê„ÑßÀá</rt></ruby><ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>Êù±<rt>„Ñâ„Ñ®„Ñ•</rt></ruby><ruby>Ë•ø<rt>Àô„Ñí„Ñß</rt></ruby>Ôºå<ruby>Ë¶Å<rt>„Ñß„Ñ†Àã</rt></ruby><ruby>Áî®<rt>„Ñ©„Ñ•Àã</rt></ruby> this (<ruby>ÈÄô<rt>„Ñì„ÑúÀã</rt></ruby><ruby>ÂÄã<rt>Àô„Ñç„Ñú</rt></ruby>)ÔºÅ" },
            { question: "A: ___ that? B: That is a girl.", options: ["Who's", "What's"], answer: 0, explanation: "<ruby>Âõû<rt>„Ñè„Ñ®„ÑüÀä</rt></ruby><ruby>Á≠î<rt>„Ñâ„ÑöÀä</rt></ruby><ruby>ÊòØ<rt>„ÑïÀã</rt></ruby> 'a girl' (<ruby>‰∏Ä<rt>„ÑßÀä</rt></ruby><ruby>ÂÄã<rt>Àô„Ñç„Ñú</rt></ruby><ruby>Â•≥<rt>„Ñã„Ñ©Àá</rt></ruby><ruby>Â≠©<rt>„Ñè„ÑûÀä</rt></ruby>)Ôºå<ruby>ÊòØ<rt>„ÑïÀã</rt></ruby><ruby>Âú®<rt>„Ñó„ÑûÀã</rt></ruby><ruby>Ë¨õ<rt>„Ñê„Ñß„Ñ§Àá</rt></ruby><ruby>‰∫∫<rt>„Ññ„Ñ£Àä</rt></ruby>Ôºå<ruby>ÊâÄ<rt>„Ñô„Ñ®„ÑõÀá</rt></ruby><ruby>‰ª•<rt>„ÑßÀá</rt></ruby><ruby>Âïè<rt>„Ñ®„Ñ£Àã</rt></ruby><ruby>È°å<rt>„Ñä„ÑßÀä</rt></ruby><ruby>Ë¶Å<rt>„Ñß„Ñ†Àã</rt></ruby><ruby>Áî®<rt>„Ñ©„Ñ•Àã</rt></ruby> Who's„ÄÇ" },
            { question: "(<ruby>Êåá<rt>„ÑìÀá</rt></ruby><ruby>Ëëó<rt>Àô„Ñì„Ñú</rt></ruby><ruby>ÈÅ†<rt>„Ñ©„Ñ¢Àá</rt></ruby><ruby>Êñπ<rt>„Ñà„Ñ§</rt></ruby><ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>ËÄÅ<rt>„Ñå„Ñ†Àá</rt></ruby><ruby>Èº†<rt>„Ñï„Ñ®Àá</rt></ruby>) <ruby>‰Ω†<rt>„Ñã„ÑßÀá</rt></ruby><ruby>Êáâ<rt>„Ñß„Ñ•</rt></ruby><ruby>Ë©≤<rt>„Ñç„Ñû</rt></ruby><ruby>ÊÄé<rt>„Ñó„Ñ£Àá</rt></ruby><ruby>È∫º<rt>Àô„Ñá„Ñú</rt></ruby><ruby>Âïè<rt>„Ñ®„Ñ£Àã</rt></ruby>Ôºü", options: ["Who's that?", "What's that?", "What's this?"], answer: 1, explanation: "<ruby>ËÄÅ<rt>„Ñå„Ñ†Àá</rt></ruby><ruby>Èº†<rt>„Ñï„Ñ®Àá</rt></ruby> (mouse) <ruby>ÊòØ<rt>„ÑïÀã</rt></ruby><ruby>Âãï<rt>„Ñâ„Ñ®„Ñ•Àã</rt></ruby><ruby>Áâ©<rt>„Ñ®Àã</rt></ruby>Ôºå<ruby>ÊâÄ<rt>„Ñô„Ñ®„ÑõÀá</rt></ruby><ruby>‰ª•<rt>„ÑßÀá</rt></ruby><ruby>Áî®<rt>„Ñ©„Ñ•Àã</rt></ruby> What„ÄÇ<ruby>Áâ†<rt>„Ñä„Ñö</rt></ruby><ruby>Âú®<rt>„Ñó„ÑûÀã</rt></ruby><ruby>ÈÅ†<rt>„Ñ©„Ñ¢Àá</rt></ruby><ruby>Êñπ<rt>„Ñà„Ñ§</rt></ruby>Ôºå<ruby>ÊâÄ<rt>„Ñô„Ñ®„ÑõÀá</rt></ruby><ruby>‰ª•<rt>„ÑßÀá</rt></ruby><ruby>Áî®<rt>„Ñ©„Ñ•Àã</rt></ruby> that„ÄÇ<ruby>Âêà<rt>„Ñè„ÑúÀä</rt></ruby><ruby>Ëµ∑<rt>„Ñë„ÑßÀá</rt></ruby><ruby>‰æÜ<rt>„Ñå„ÑûÀä</rt></ruby><ruby>Â∞±<rt>„Ñê„Ñß„Ñ°Àã</rt></ruby><ruby>ÊòØ<rt>„ÑïÀã</rt></ruby> What's that?„ÄÇ" },
            { question: "'Who is this?' <ruby>ÂèØ<rt>„Ñé„ÑúÀá</rt></ruby><ruby>‰ª•<rt>„ÑßÀá</rt></ruby><ruby>Á∏Æ<rt>„Ñô„Ñ®„Ñõ</rt></ruby><ruby>ÂØ´<rt>„Ñí„Ñß„ÑùÀá</rt></ruby><ruby>Êàê<rt>„Ñî„Ñ•Àä</rt></ruby>...", options: ["Who's this?", "Whos' this?"], answer: 0, explanation: "'Who is' <ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>Á∏Æ<rt>„Ñô„Ñ®„Ñõ</rt></ruby><ruby>ÂØ´<rt>„Ñí„Ñß„ÑùÀá</rt></ruby><ruby>ÊòØ<rt>„ÑïÀã</rt></ruby> Who'sÔºå<ruby>‰∏Ä<rt>„ÑßÀä</rt></ruby><ruby>Êíá<rt>„ÑÜ„Ñß„ÑùÀá</rt></ruby> (') <ruby>Ë¶Å<rt>„Ñß„Ñ†Àã</rt></ruby><ruby>Âú®<rt>„Ñó„ÑûÀã</rt></ruby> s <ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>Ââç<rt>„Ñë„Ñß„Ñ¢Àä</rt></ruby><ruby>Èù¢<rt>„Ñá„Ñß„Ñ¢Àã</rt></ruby>„ÄÇ" }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let questions = [];
        let wrongQuestions = [];

        const quizArea = document.getElementById('quiz-area');
        const endScreen = document.getElementById('end-screen');
        const questionEl = document.getElementById('question');
        const optionsContainer = document.getElementById('options-container');
        const resultEl = document.getElementById('result');
        const explanationEl = document.getElementById('explanation-container');
        const progressEl = document.getElementById('progress');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        const retestWrongBtn = document.getElementById('retest-wrong-btn');
        const gameImage = document.getElementById('game-image');
        const gameStatus = document.getElementById('game-status');

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startGame(questionList) {
            questions = [...questionList];
            shuffle(questions);
            currentQuestionIndex = 0;
            score = 0;
            wrongQuestions = [];
            
            quizArea.style.display = 'block';
            endScreen.style.display = 'none';
            gameImage.src = 'initial.png';
            gameImage.className = '';
            gameStatus.textContent = 'üéØ';
            gameStatus.className = '';
            
            showQuestion();
        }

        function showQuestion() {
            resetState();
            const currentQuestion = questions[currentQuestionIndex];
            // MODIFIED: Use .innerHTML to render ruby tags
            progressEl.innerHTML = `<ruby>Á¨¨<rt>„Ñâ„ÑßÀã</rt></ruby> ${currentQuestionIndex + 1} / ${questions.length} <ruby>È°å<rt>„Ñä„ÑßÀä</rt></ruby>`;
            questionEl.innerHTML = currentQuestion.question;

            currentQuestion.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option; // Options are in English, so textContent is fine
                button.classList.add('option-btn');
                button.dataset.index = index;
                button.addEventListener('click', selectAnswer);
                optionsContainer.appendChild(button);
            });
        }

        function resetState() {
            resultEl.innerHTML = ''; // Use .innerHTML
            explanationEl.style.display = 'none';
            nextBtn.style.display = 'none';
            while (optionsContainer.firstChild) {
                optionsContainer.removeChild(optionsContainer.firstChild);
            }
            gameImage.src = 'initial.png';
            gameImage.className = '';
            gameStatus.textContent = 'üéØ';
            gameStatus.className = '';
        }

        function selectAnswer(e) {
            const selectedBtn = e.target;
            const selectedIndex = parseInt(selectedBtn.dataset.index);
            const currentQuestion = questions[currentQuestionIndex];
            const correctIndex = currentQuestion.answer;

            Array.from(optionsContainer.children).forEach(button => {
                button.disabled = true;
            });

            if (selectedIndex === correctIndex) {
                score++;
                selectedBtn.classList.add('correct');
                resultEl.innerHTML = '‚úÖ <ruby>Ê≠£<rt>„Ñì„Ñ•Àã</rt></ruby><ruby>Á¢∫<rt>„Ñë„Ñ©„ÑùÀã</rt></ruby>ÔºÅ<ruby>Â§™<rt>„Ñä„ÑûÀã</rt></ruby><ruby>Ê£í<rt>„ÑÖ„Ñ§Àã</rt></ruby><ruby>‰∫Ü<rt>Àô„Ñå„Ñú</rt></ruby>ÔºÅ'; // Use .innerHTML
                resultEl.style.color = '#2ecc71';
                gameImage.src = 'correct.png';
                gameImage.classList.add('correct');
                gameStatus.textContent = 'üéâ';
                gameStatus.classList.add('correct');
                
                setTimeout(() => {
                    currentQuestionIndex++;
                    if (currentQuestionIndex < questions.length) {
                        showQuestion();
                    } else {
                        endGame();
                    }
                }, 1500);
            } else {
                selectedBtn.classList.add('incorrect');
                optionsContainer.children[correctIndex].classList.add('correct');
                resultEl.innerHTML = '‚ùå <ruby>Á≠î<rt>„Ñâ„ÑöÀä</rt></ruby><ruby>ÈåØ<rt>„Ñò„Ñ®„ÑõÀã</rt></ruby><ruby>‰∫Ü<rt>Àô„Ñå„Ñú</rt></ruby>Ôºå<ruby>ÂÜç<rt>„Ñó„ÑûÀã</rt></ruby><ruby>Êé•<rt>„Ñê„Ñß„Ñù</rt></ruby><ruby>ÂÜç<rt>„Ñó„ÑûÀã</rt></ruby><ruby>Âé≤<rt>„Ñå„ÑßÀã</rt></ruby>ÔºÅ'; // Use .innerHTML
                resultEl.style.color = '#e74c3c';
                gameImage.src = 'incorrect.png';
                gameImage.classList.add('incorrect');
                gameStatus.textContent = 'üòÖ';
                gameStatus.classList.add('incorrect');
                
                explanationEl.innerHTML = `üí° <ruby>Êñá<rt>„Ñ®„Ñ£Àä</rt></ruby><ruby>Ê≥ï<rt>„Ñà„ÑöÀá</rt></ruby><ruby>Ëß£<rt>„Ñê„Ñß„ÑùÀá</rt></ruby><ruby>Êûê<rt>„Ñí„Ñß</rt></ruby>Ôºö${currentQuestion.explanation}`; // Use .innerHTML
                explanationEl.style.display = 'block';

                wrongQuestions.push({
                    ...currentQuestion,
                    userAnswer: currentQuestion.options[selectedIndex]
                });
                nextBtn.style.display = 'block';
            }
        }

        function endGame() {
            quizArea.style.display = 'none';
            endScreen.style.display = 'block';
            
            const scoreEl = document.getElementById('score');
            scoreEl.innerHTML = `üéØ <ruby>‰Ω†<rt>„Ñã„ÑßÀá</rt></ruby><ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>ÊúÄ<rt>„Ñó„Ñ®„ÑüÀã</rt></ruby><ruby>ÁµÇ<rt>„Ñì„Ñ®„Ñ•</rt></ruby><ruby>ÂàÜ<rt>„Ñà„Ñ£</rt></ruby><ruby>Êï∏<rt>„Ñï„Ñ®Àã</rt></ruby>Ôºö${score} / ${questions.length} (${Math.round(score/questions.length*100)}%)`; // Use .innerHTML

            const wrongQuestionsEl = document.getElementById('wrong-questions');
            if (score === questions.length) {
                gameImage.src = 'all_correct.png';
                gameImage.classList.add('all-correct');
                gameStatus.textContent = 'üèÜ';
                gameStatus.classList.add('all-correct');
                wrongQuestionsEl.innerHTML = 'üéä <ruby>Â§™<rt>„Ñä„ÑûÀã</rt></ruby><ruby>Ê£í<rt>„ÑÖ„Ñ§Àã</rt></ruby><ruby>‰∫Ü<rt>Àô„Ñå„Ñú</rt></ruby>ÔºÅ<ruby>‰Ω†<rt>„Ñã„ÑßÀá</rt></ruby><ruby>ÂÖ®<rt>„Ñë„Ñ©„Ñ¢Àä</rt></ruby><ruby>ÈÉ®<rt>„ÑÖ„Ñ®Àã</rt></ruby><ruby>Á≠î<rt>„Ñâ„ÑöÀä</rt></ruby><ruby>Â∞ç<rt>„Ñâ„Ñ®„ÑüÀã</rt></ruby><ruby>‰∫Ü<rt>Àô„Ñå„Ñú</rt></ruby>ÔºÅ<ruby>‰Ω†<rt>„Ñã„ÑßÀá</rt></ruby><ruby>Â∑≤<rt>„ÑßÀá</rt></ruby><ruby>Á∂ì<rt>„Ñê„Ñß„Ñ•</rt></ruby><ruby>ÊòØ<rt>„ÑïÀã</rt></ruby> Who/What <ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>Â∞è<rt>„Ñí„Ñß„Ñ†Àá</rt></ruby><ruby>Â∞à<rt>„Ñì„Ñ®„Ñ¢</rt></ruby><ruby>ÂÆ∂<rt>„Ñê„Ñß„Ñö</rt></ruby><ruby>‰∫Ü<rt>Àô„Ñå„Ñú</rt></ruby>ÔºÅ üéä'; // Use .innerHTML
                wrongQuestionsEl.style.borderLeftColor = '#2ecc71';
                wrongQuestionsEl.style.background = '#d4edda';
                wrongQuestionsEl.style.color = '#155724';
                wrongQuestionsEl.style.display = 'block';
                retestWrongBtn.style.display = 'none';
            } else {
                gameImage.src = 'not_all_correct.png';
                gameStatus.textContent = 'üìù';
                let wrongText = `<h3>üìã <ruby>‰Ω†<rt>„Ñã„ÑßÀá</rt></ruby><ruby>Á≠î<rt>„Ñâ„ÑöÀä</rt></ruby><ruby>ÈåØ<rt>„Ñò„Ñ®„ÑõÀã</rt></ruby><ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>È°å<rt>„Ñä„ÑßÀä</rt></ruby><ruby>ÁõÆ<rt>„Ñá„Ñ®Àã</rt></ruby><ruby>Âõû<rt>„Ñè„Ñ®„ÑüÀä</rt></ruby><ruby>È°ß<rt>„Ñç„Ñ®Àã</rt></ruby>Ôºö</h3>`;
                wrongQuestions.forEach((q, index) => {
                    wrongText += `<p>`;
                    wrongText += `${index + 1}. ${q.question}<br>`;
                    wrongText += `&nbsp;&nbsp;&nbsp;<ruby>‰Ω†<rt>„Ñã„ÑßÀá</rt></ruby><ruby>ÁöÑ<rt>Àô„Ñâ„Ñú</rt></ruby><ruby>Á≠î<rt>„Ñâ„ÑöÀä</rt></ruby><ruby>Ê°à<rt>„Ñ¢Àã</rt></ruby>: "${q.userAnswer}" ‚ùå<br>`;
                    wrongText += `&nbsp;&nbsp;&nbsp;<ruby>Ê≠£<rt>„Ñì„Ñ•Àã</rt></ruby><ruby>Á¢∫<rt>„Ñë„Ñ©„ÑùÀã</rt></ruby><ruby>Á≠î<rt>„Ñâ„ÑöÀä</rt></ruby><ruby>Ê°à<rt>„Ñ¢Àã</rt></ruby>: "${q.options[q.answer]}" ‚úÖ<br>`;
                    wrongText += `&nbsp;&nbsp;&nbsp;<ruby>Ëß£<rt>„Ñê„Ñß„ÑùÀá</rt></ruby><ruby>Êûê<rt>„Ñí„Ñß</rt></ruby>: ${q.explanation}<br>`;
                    wrongText += `</p>`;
                });
                wrongQuestionsEl.innerHTML = wrongText; // Use .innerHTML
                wrongQuestionsEl.style.borderLeftColor = '#e74c3c';
                wrongQuestionsEl.style.background = '#f8d7da';
                wrongQuestionsEl.style.color = '#721c24';
                wrongQuestionsEl.style.display = 'block';
                retestWrongBtn.style.display = 'inline-block';
            }
        }
        
        nextBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                showQuestion();
            } else {
                endGame();
            }
        });

        restartBtn.addEventListener('click', () => startGame(allQuestions));

        retestWrongBtn.addEventListener('click', () => {
            if (wrongQuestions.length > 0) {
                const retestList = wrongQuestions.map(({ userAnswer, ...rest }) => rest);
                startGame(retestList);
            }
        });

        startGame(allQuestions);
    </script>
</body>
</html>
